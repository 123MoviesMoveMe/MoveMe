<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamMoveMe</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body{
            display: flex;
            Justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            margin: 0px;
        }
    </style>
</head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sign Up</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
<body>
    <div class="container">
        <h1>Register</h1>
        <p>Please fill in the box to create an account</p>
        <hr>
        <label for="Full Name"><b>Full Name</b></label>
        <input type="text" placeholder=" Enter Full Name" id="name" class="form-control ">
        <label for="Email"><b>Email</b></label>
        <input type="text" placeholder="Enter Email" name="Email" id="Email" class="form-control ">
        <label for="Username"><b>Username</b></label>
        <input type="Username" placeholder="Username" name="UserName" id="Username" class="form-control ">
        <label><b>Password</b></label>
        <input type="Password" placeholder="Enter Password" name="Username" id="password" class="form-control ">
        <hr>
        <p> By creating this Account you agree to our <a href="#">Terms and Privacy</a>. </p>
        <button type="button" id="SubmitData" name= "SubmitData" class= "registerbtn">Register</button>
        <a href="Login.html" class="badge badge-secondary py-1 ww-100">Already Have An Account</a>
    </div>
    
</body>
</html>


<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-auth.js";
    import { getDatabase,set,ref, update } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-database.js";


    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDRoIiQPye6oUcQktSabcdOVefEzt_kIDw",
      authDomain: "projectdemo-2d2f5.firebaseapp.com",
      projectId: "projectdemo-2d2f5",
      storageBucket: "projectdemo-2d2f5.appspot.com",
      messagingSenderId: "580695378532",
      appId: "1:580695378532:web:c952311f9c9c27ffee6d71",
      measurementId: "G-VBFNB852QP"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const database = getDatabase(app);


    SubmitData.addEventListener('click',(e) => {
        var Email = document.getElementById('Email').value;
        var password = document.getElementById('password').value;
        var Username = document.getElementById('Username').value;
        var name = document.getElementById('Name')

        createUserWithEmailAndPassword(auth, Email, password, Username)
            .then((userCredential) => {
                // Signed in 
                const user = userCredential.user;
                // ... user.uid
                set(ref(database, 'users/' + user.uid), {
                    username: name,
                    email: Email,
                    profile_picture : imageUrl
                })
                    .then(() => {
                        // Data saved successfully!
                        alert('user created successfully');
                    })
                    .catch((error) => {
                        // The write failed...
                        alert('error');
                    });

            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                // ..
                alert('errorMessage');
             });

        signInWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
                // Signed in 
                const user = userCredential.user;
                // ...
                var lgData = new Date();
                update(ref(database, 'users/' + user.uid), {
                    last_login: lgDate,
                    email: Email,
                    profile_picture : imageUrl
                })
                    .then(() => {
                        // Data saved successfully!
                        alert('user logged in successfully');
                    })
                    .catch((error) => {
                        // The write failed...
                        alert('error');
                    });
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                alert(errorMessage);
            });

        signOut(auth).then(() => {
            // Sign-out Successful
        }) .catch((error) => {
            //An Error happened
        })
    });
  </script>