<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>123Movies</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        @import url('https://fonts.googleapis.com/css?family=Montserrat:400,800');
        *{
            box-sizing: border-box;
        }
        body{
            display: flex;
            Justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            margin: 0px;
            
            background: rgb(249, 246, 248);
        }
    </style>
</head>

<body>
    <div class="mb-5">
        <h3 class="mb-3">Register</h3>
        <p>Please fill in the box to create an account</p>
        <hr>
        <label for="Email"><b>Email</b></label>
        <input type="text" placeholder="Enter Email" name="Email" id="email" class="form-control mb-3 ">
        <label for="Username"><b>Username</b></label>
        <input type="Username" placeholder="Username" name="UserName" id="Username" class="form-control mb-3">
        <label><b>Password</b></label>
        <input type="Password" placeholder="Enter Password" name="password" id="paw" class="form-control mb-3">
        <hr>
        <p> By creating this Account you agree to our <a href="#">Terms and Privacy</a>. </p>
        <button type="button" id="SubmitData" name= "SubmitData" class= "btn w-100 btn-outline-primary mb-3">Register</button>
        <a href="Login.html" class="badge badge-secondary py-1 ww-100">Already Have An Account</a>
    </div>
    

    <script defer src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.10.0/firebase-auth-compat.js"></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        //import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
         //import {getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut} from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
        //import { getFirestore } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js";
        import { getDatabase,set,ref, get } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js";

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
  
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
        apiKey: "AIzaSyCFU6jSceooLrksmulCGGajPXXpMAZxJR0",
        authDomain: "software-engineering-7af33.firebaseapp.com",
        projectId: "software-engineering-7af33",
        storageBucket: "software-engineering-7af33.appspot.com",
        messagingSenderId: "15705666687",
        appId: "1:15705666687:web:f9cff180f0d81e29cd7b4a",
        measurementId: "G-KWT004WCW9"
        };
  
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        //const auth = getAuth(app);
        const database = getDatabase();
        //firebase.initializeApp(firebaseConfig);

        const name = document.getElementById('Name');
        const Email = document.getElementById('email');
        const Username = document.getElementById('Username');
        const password = document.getElementById('paw');
        const submit = document.getElementById('SubmitData');

        function Validation(){
            let nameregex = /^[a-zA-Z\s]+$/;
            let Email = /^[a-zA-Z0-9]+@(gmail|yahoo|pride.hofstra.edu)\.com$/;    //Any number made of A-Z and 0-9 requirement for validation
            let Userregrex = /^[a-zA-Z0-9]{5,}$/; //at least 5 characters

            if(!nameregex.test(name.value)){
                alert("the name should only contain alpahabets!");
                return false;
            }

            if(!email.test(Email.value)){
                alert("enter a valid Email");
                return false;
            }
            if(!userregex.test(Username.value)){
                alert("the username should only contain alpahanumeric!\n-username must be atleast 5 characters\n-username connot contain spaces");
                return false;
            }
            return true;

        }
        
        function registerUser(){
            if(!Validation()){
                return;
            };
            const dbRef = ref(database);
            get(child(dbRef, "users/"+ Username.value)).then((snapshot)=>{
                if(snapshot.exits()){
                    alert("Account Already Exist");
                }

                else{
                    set(ref(database, "users/".Username.value),
                     {
                        fullname: Name.value,
                        Email: email.value,
                        username: Username.value,
                        password: paw.value

                    })
                    .then(()=>{
                        alert("user added successfully");
                    })
                    .catch((error)=>{
                        alert("error"+error);
                    })
              
                }

        
                   
            });
        }

            submit.addEventListener('click',registerUser);
    </script>  
</body>


</html>



    
  <!--<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sign Up</title>-->
  
  
  
  
  
  <!--
  <script defer src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.10.0/firebase-auth-compat.js"></script>
  
  <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
      import {getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut} from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js";
      import { getDatabase,set,ref, update } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js";
  
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyCFU6jSceooLrksmulCGGajPXXpMAZxJR0",
        authDomain: "software-engineering-7af33.firebaseapp.com",
        projectId: "software-engineering-7af33",
        storageBucket: "software-engineering-7af33.appspot.com",
        messagingSenderId: "15705666687",
        appId: "1:15705666687:web:f9cff180f0d81e29cd7b4a",
        measurementId: "G-KWT004WCW9"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase(app);
      firebase.initializeApp(firebaseConfig);
  
  
      SubmitData.addEventListener('click',(e) => {
          var Email = document.getElementById('Email').value;
          var password = document.getElementById('password').value;
          var Username = document.getElementById('Username').value;
          var name = document.getElementById('Name').value;
  
          createUserWithEmailAndPassword(auth, Email, password, Username)
              .then((userCredential) => {
                  // Signed in 
                  const user = userCredential.user;
                  // ... user.uid
                  set(ref(database, 'users/' + user.uid), {
                      username: name,
                      email: Email,
                      profile_picture : imageUrl
                  })
                      .then(() => {
                          // Data saved successfully!
                          alert('user created successfully');
                      })
                      .catch((error) => {
                          // The write failed...
                          alert('error');
                      });
  
              })
              .catch((error) => {
                  const errorCode = error.code;
                  const errorMessage = error.message;
                  // ..
                  alert(errorMessage);
               });
  
          signInWithEmailAndPassword(auth, email, password)
              .then((userCredential) => {
                  // Signed in 
                  const user = userCredential.user;
                  // ...
                  var lgData = new Date();
                  update(ref(database, 'users/' + user.uid), {
                      last_login: lgDate,
                      email: Email,
                      profile_picture : imageUrl
                  })
                      .then(() => {
                          // Data saved successfully!
                          alert('user logged in successfully');
                      })
                      .catch((error) => {
                          // The write failed...
                          alert(error);
                      });
              })
              .catch((error) => {
                  const errorCode = error.code;
                  const errorMessage = error.message;
                  alert(errorMessage);
              });
  
          signOut(auth).then(() => {
              // Sign-out Successful
          }) .catch((error) => {
              //An Error happened
          })
      });
  
    </script>
    -->